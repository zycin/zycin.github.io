<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zycin | GeekBlog</title>
<meta name="description" content="ä¸å¿˜åˆå¿ƒ  æ–¹å¾—å§‹ç»ˆ" />
<link rel="shortcut icon" href="https://fastt.cn/favicon.ico?v=1573026457483">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link href="https://cdn.remixicon.com/releases/v1.3.1/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">

<link rel="stylesheet" href="https://fastt.cn/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Zycin | GeekBlog - Atom Feed" href="https://fastt.cn/atom.xml">


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150684183-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150684183-1');
</script>


  </head>
  <body>
    <div id="app" class="main px-4 flex flex-col lg:flex-row">
      <div id="sidebar" class="sidebar-wrapper lg:static lg:w-1/4">
  <div class="lg:sticky top-0">
    <div class="sidebar-content">
      <div class="flex lg:block p-4 lg:px-0 items-center fixed lg:static lg:block top-0 right-0 left-0 bg-white z-50">
        <i class="remixicon-menu-2-line lg:mt-4 text-2xl cursor-pointer animated fadeIn" onclick="openMenu()"></i>
        <a href="https://fastt.cn">
          <img class="animated fadeInLeft avatar rounded-lg mx-4 lg:mt-32 lg:mx-0 mt-0 lg:w-24 lg:h-24 w-12 w-12" src="https://fastt.cn/images/avatar.png?v=1573026457483" alt="">
        </a>
        <h1 class="animated fadeInLeft lg:text-4xl font-extrabold lg:mt-8 mt-0 text-xl" style="animation-delay: 0.2s">Zycin | GeekBlog</h1>
      </div>
      
        <div class="animated fadeInLeft" style="animation-delay: 0.4s">
          <p class="my-4 text-gray-600 font-light hidden lg:block">
            æ–‡ç« ç›®å½•
          </p>
          <div class="toc-container hidden lg:block">
            <ul class="markdownIt-TOC">
<li><a href="#nodemysql">node+mysql</a>
<ul>
<li><a href="#%E5%B0%81%E8%A3%85%E8%BF%9E%E6%8E%A5">å°è£…è¿æ¥</a></li>
<li><a href="#curd%E6%93%8D%E4%BD%9C">CURDæ“ä½œ</a>
<ul>
<li><a href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5">æŸ¥è¯¢è¯­å¥</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#mvc%E7%AE%80%E4%BB%8B">MVCç®€ä»‹</a>
<ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B">æ•°æ®æ¨¡å‹</a></li>
<li><a href="#lautin-model">lautin-model</a>
<ul>
<li><a href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85">ä¸‹è½½å®‰è£…</a></li>
<li><a href="#%E5%9F%BA%E6%9C%ACcurd">åŸºæœ¬CURD</a></li>
<li><a href="#%E9%93%BE%E5%BC%8F%E6%93%8D%E4%BD%9C">é“¾å¼æ“ä½œ</a></li>
<li><a href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0">å›è°ƒå‡½æ•°</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8">é«˜çº§åº”ç”¨</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      
    </div>
  </div>
</div>

<div class="menu-container">
  <i class="remixicon-arrow-left-line text-2xl cursor-pointer animated fadeIn close-menu-btn" onclick="closeMenu()"></i>
  <div>
    
      
        <a href="/" class="menu" style="animation-delay: 0s">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu" style="animation-delay: 0.2s">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu" style="animation-delay: 0.4s">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu" style="animation-delay: 0.6000000000000001s">
          å…³äº
        </a>
      
    
  </div>
  <div class="site-footer">
    <div class="py-4 text-gray-700">Powered by <a href="https://github.com/zycin" target="_blank">Zycin</a></div>
    <a class="rss" href="https://fastt.cn/atom.xml" target="_blank">RSS</a>
  </div>
</div>
<div class="mask" onclick="closeMenu()">
</div>
      <div class="content-wrapper py-32 lg:p-8 lg:w-3/4 post-detail animated fadeIn">
        <h1 class="text-3xl font-bold lg:mt-16">nodeJSç¬¬å››é˜¶æ®µ</h1>
        <div class="text-sm text-gray-700 lg:my-8">
          2019-10-08 / 13 min read
        </div>
        
          <img class="post-feature-image rounded-lg mx-auto my-4" src="https://fastt-1252391792.file.myqcloud.com/nodejs4.jpg" alt="">
        
        <div class="post-content yue">
          <p>å°†<strong>NodeJs</strong>åˆ†ä¸ºå››ä¸ªé˜¶æ®µ<br>
ç¬¬å››é˜¶æ®µ~<br>
<code>node+mysql</code><br>
begin enjoyğŸ‘‡</p>
<!-- more -->
<h1 id="nodemysql">node+mysql</h1>
<p>nodejsåŒå…¶ä»–çš„æœåŠ¡ç«¯è¯­è¨€å¹³å°ä¸€æ · å…·å¤‡æ•°æ®åº“æ“ä½œçš„èƒ½åŠ›ã€‚nodejsåˆæœŸ ä¸»è¦ä¸mongodbæ­é… å®ç°æ•°æ®åº“æ“ä½œï¼Œéšç€ä¸šåŠ¡å’Œè¯­è¨€çš„å‘å±• ç°åœ¨å®ƒä¸mysqlå’Œå…¶ä»–æ•°æ®åº“çš„äº¤äº’è¶Šæ¥è¶Šå¤šã€‚ä½¿ç”¨ä¹‹å‰éœ€è¦ä¸‹è½½nodeæ‰§è¡Œmysqlæ“ä½œçš„æ¨¡å— - <code>npm install mysql --global</code></p>
<p><code>const mysql = require(&quot;mysql&quot;);</code></p>
<p>ä½¿ç”¨mysqlæ¨¡å—é“¾æ¥æ•°æ®åº“ï¼š</p>
<ol>
<li>
<p>é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼šæ•°æ®åº“æœåŠ¡å™¨åœ°å€ã€ç”¨æˆ·è´¦å·ã€å¯†ç ã€è®¿é—®çš„æ•°æ®åº“</p>
</li>
<li>
<p>åˆ›å»ºæ•°æ®åº“è¿æ¥å¯¹è±¡ï¼š æ‰§è¡Œæ•°æ®åº“çš„è¿æ¥</p>
</li>
<li>
<p>æ‰§è¡Œmysqlæ•°æ®åº“çš„æ“ä½œï¼šæ‰§è¡Œå¢åˆ æ”¹æŸ¥è¯­å¥</p>
</li>
<li>
<p>æ‰§è¡Œå®Œæ¯• å…³é—­ä¸mysqlæœåŠ¡çš„è¿æ¥</p>
</li>
</ol>
<pre><code class="language-javascript">//åˆ›å»ºè¿æ¥
const link = mysql.createConnection({
    host : &quot;localhost&quot;,	//æ•°æ®åº“æœåŠ¡å™¨åœ°å€
    port : &quot;3306&quot;,	//ç«¯å£å·
    user : &quot;root&quot;,	//è´¦å·
    password : &quot;&quot;,	//å¯†ç 
    database : &quot;test&quot;,	//è¦è¿æ¥çš„æ•°æ®åº“
});

//æ‰§è¡Œè¿æ¥
link.connect((err) =&gt; {
    if (err)   console.log(err.message);
    else {
        console.log(&quot;mysqlæœåŠ¡å·²è¿æ¥ï¼Œçº¿ç¨‹å·ï¼š&quot; + link.threadId); 
    }
});

//ä½¿ç”¨queryæ–¹æ³•æ‰§è¡Œæ“ä½œ
link.query(&quot;SHOW TABLES&quot;, () =&gt; {});

//å…³é—­æ•°æ®åº“è¿æ¥
link.end((err) =&gt; {
    if (err) console.log(err.message);
    else {
        console.log(&quot;æ•°æ®åº“æœåŠ¡å·²ç»å…³é—­&quot;);
        //å…³é—­ä¹‹å ä¸èƒ½å†æ‰§è¡Œæ•°æ®åº“æ“ä½œ
    }
});
</code></pre>
<h2 id="å°è£…è¿æ¥">å°è£…è¿æ¥</h2>
<pre><code class="language-javascript">//åˆ›å»ºæ•°æ®åº“è¿æ¥çš„æ¨¡å— - db.connect.js

const mysql = require(&quot;mysql&quot;);

const link = mysql.createConnection({
    host: &quot;localhost&quot;,
    port: &quot;3306&quot;,
    user: &quot;root&quot;,
    password: &quot;&quot;,
    database: &quot;student&quot;,

});

//åˆ›å»ºæ•°æ®åº“è¿æ¥
link.connect((err) =&gt; {
    if (err) console.log(err.message);
    else {
        console.log(&quot;mysqlæœåŠ¡å·²è¿æ¥ï¼Œçº¿ç¨‹å·ï¼š&quot; + link.threadId);
    }
});

//å¯¼å‡ºè¿æ¥å¯¹è±¡
module.exports = link;
</code></pre>
<h2 id="curdæ“ä½œ">CURDæ“ä½œ</h2>
<h3 id="æŸ¥è¯¢è¯­å¥">æŸ¥è¯¢è¯­å¥</h3>
<ul>
<li>
<p>è¯­æ³•ç»“æ„ï¼š</p>
<ul>
<li><code>SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å WHEREæ¡ä»¶å­å¥ ORDERæ’åºå­å¥ LIMITå­å¥</code></li>
<li><code>SELECT * FROM shop_goods ORDER BY gid DESC LIMIT 10</code></li>
</ul>
</li>
<li>
<p>nodeä»£ç ï¼š</p>
<pre><code class="language-javascript">//åŠ è½½æ•°æ®åº“è¿æ¥çš„æ¨¡å—
const link = require(&quot;./db.connect&quot;);

//æ‰§è¡ŒæŸ¥è¯¢ä»»åŠ¡çš„sqlæŒ‡ä»¤
link.query(&quot;SELECT * FROM  user&quot;, (err, result) =&gt; {
    if (err) {
        console.log(&quot;sqlé”™è¯¯æç¤ºï¼š&quot; + err.sqlMessage);
        console.log(&quot;å½“å‰æ‰§è¡Œsqlï¼š&quot; + err.sql);
    } else {
        console.log(result);
    }
});
</code></pre>
</li>
<li>
<p>æ‰§è¡Œç»“æœï¼š</p>
<ul>
<li>æ‰§è¡ŒæˆåŠŸæ—¶ errä¸ºnullï¼Œresultä¸º<mark>æŸ¥è¯¢ç»“æœé›†</mark> - <strong>DataRowPocket</strong>å¯¹è±¡é›†åˆæ•°ç»„ï¼›æ•°æ®è¡¨ä¸­æ¯æ¡è®°å½• å¯¹åº”ä¸€ä¸ªæ•°æ®å¯¹è±¡ å­—æ®µåä¸ºå¯¹è±¡çš„å±æ€§ ã€‚</li>
<li>æ‰§è¡Œå¤±è´¥æ—¶ errä¸º<mark>é”™è¯¯å¯¹è±¡</mark> ï¼Œresultä¸ºnull</li>
</ul>
</li>
<li>
<p>å¤§å®¶ä½¿ç”¨node+mysqlæŸ¥è¯¢è¡¨æ•°æ®å¹¶åœ¨é¡µé¢ä¸­æ˜¾ç¤º</p>
</li>
</ul>
<h1 id="mvcç®€ä»‹">MVCç®€ä»‹</h1>
<p>æˆ‘ä»¬ç»å¸¸è¯´ åœ¨æœåŠ¡ç«¯ä½¿ç”¨MVCè®¾è®¡æ¨¡å¼æ¥è¿›è¡Œå¼€å‘ï¼ŒMVCåˆ†åˆ«è¡¨ç¤ºï¼š</p>
<ul>
<li>Cï¼šController å³æ§åˆ¶å™¨ æ˜¯é€šè¿‡è·¯ç”±æ§åˆ¶æ¥å®ç°ä¸šåŠ¡æµç¨‹å’Œé€»è¾‘ç®¡ç†</li>
<li>Vï¼šView å³è§†å›¾å±‚ï¼Œç”¨æ¥æ¸²æŸ“é¡µé¢ã€‚é€šå¸¸éœ€è¦ä½¿ç”¨æ¨¡æ¿å¼•æ“æ¥æ“ä½œï¼Œé€šè¿‡é¡µé¢è¡¨ç°å’Œç¨‹åºåˆ†ç¦» å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ï¼ŒåŒæ—¶ä¹Ÿèƒ½å®ç°æ›´ä¸ºé«˜æ•ˆçš„ååŒå¼€å‘ã€‚
<ul>
<li>Node.js/Python/Javaç¨‹åºå‘˜ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„è®¾è®¡å’Œç¨‹åºç¼–ç </li>
<li>å‰ç«¯å¼€å‘æˆ–è€…ç¾å·¥ä¸“èŒäºç”¨æˆ·äº¤äº’æ•ˆæœçš„å®ç°</li>
</ul>
</li>
<li>Mï¼šModelå³æ•°æ®æ¨¡å‹ï¼Œå°è£…æ–¹æ³•ç”¨æ¥å¿«é€Ÿå®ç°æ•°æ®çš„æ“ä½œã€‚è¿™æ ·å¼€æ”¾äººå‘˜ å°±èƒ½æ›´å¤šçš„å°†ç»å†æ”¾åœ¨ä¸šåŠ¡çš„è®¾è®¡å’Œæ¶æ„ä¸Šï¼Œè€Œä¸ç”¨è¿‡å¤šè€ƒè™‘å®ç°çš„é—®é¢˜ã€‚</li>
</ul>
<p>åœ¨MVCç»“æ„ä¸­ï¼ŒCå±‚æ˜¯æ ¸å¿ƒ ç”¨æ¥æ§åˆ¶ä¸šåŠ¡æµï¼Œåœ¨å®ç°çš„è¿‡ç¨‹ä¸­ å¦‚æœéœ€è¦è¿›è¡Œæ•°æ®æ“ä½œ åˆ™è°ƒç”¨Må±‚å®ç°å°è£…å·çš„æ–¹æ³•ï¼›å¦‚æœéœ€è¦æ¸²æŸ“é¡µé¢ åˆ™åŠ è½½æ¨¡æ¿å¼•æ“ç¼–è¯‘æ¨¡æ¿é¡µé¢è¿”å›ç»™ç”¨æˆ·ã€‚</p>
<h2 id="æ•°æ®æ¨¡å‹">æ•°æ®æ¨¡å‹</h2>
<p>åœ¨æ•°æ®ä¸­ï¼Œå®ƒé¦–å…ˆæ”¯æŒåŸºæœ¬çš„CURDä¸šåŠ¡ï¼ŒåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥</p>
<ul>
<li>
<p>selectï¼šselect/findAllæ˜¯æŸ¥é›†åˆæ•°æ®ï¼Œè¡¨ä¸­çš„ä¸€æ¡è®°å½•ä¸ºä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œå¤šæ¡ç»“æœé›†å°±æ˜¯å¯¹è±¡é›†åˆçš„æ•°ç»„å½¢å¼ï¼›å³ä½¿åªæœ‰ä¸€æ¡ç¬¦åˆæŸ¥è¯¢çš„ç»“æœ å®ƒä¹Ÿè¿”å›æ•°ç»„ã€‚</p>
<ul>
<li>æ•°æ®æ¨¡æ¿ï¼š<code>SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å WHERE æ¡ä»¶å­—å¥ ORDER BY æ’åºå­—å¥ LIMIT é™åˆ¶å­—å¥</code></li>
<li>ä»æ•°æ®æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾—çŸ¥ å°½ç®¡ä¸åŒçš„sqlæŸ¥è¯¢è¯­å¥ å®ƒä»¬çš„å‚æ•°ä¸ä¸€æ · ä½†sqlç»“æ„éƒ½æ˜¯ä¸€æ ·ã€‚é‚£æˆ‘ä»¬å¯ä»¥è€ƒè™‘ æå–sqlç»“æ„ ç„¶åä»¥å‚æ•°å½¢å¼ æ¥æ‰§è¡Œä¸€æ¡å…·ä½“çš„æŒ‡ä»¤</li>
<li>åœ¨æŸ¥è¯¢ä¸­ éœ€è¦è®¾ç½®çš„å‚æ•°æœ‰ï¼š<code>å­—æ®µåˆ—è¡¨ã€è¡¨åã€æ¡ä»¶å­—å¥ã€æ’åºå­—å¥ã€é™åˆ¶å­—å¥</code></li>
<li>å°è£…ä¸€ä¸ªselectæ–¹æ³• ä¼ å…¥ä¸Šè¿°å‚æ•°ã€‚æ¥ä¸‹æ¥åœ¨selectæ–¹æ³•ä¸­ ç»„è£…è¯¥æ¡sqlè¯­å¥ï¼Œç„¶åæ‰§è¡Œè¿”å›ç»“æœï¼š<code>select(å­—æ®µåˆ—è¡¨ã€è¡¨åã€æ¡ä»¶å­—å¥ã€æ’åºå­—å¥ã€é™åˆ¶å­—å¥)</code></li>
</ul>
<pre><code class="language-javascript">//SELECT * FROM users WHERE uid &gt; 100 ORDER BY uid DESC LIMIT 10
const rows = select(&quot;*&quot;, &quot;users&quot;, &quot;uid &gt; 100&quot;, &quot;uid DESC&quot;, 10);
</code></pre>
<pre><code class="language-json">//å¯¹è±¡é›†åˆæ•°ç»„çš„å¤šæ¡è®°å½• å½¢å¦‚è¿™æ ·ï¼š
rows = [
    {uid : 1, uname : &quot;lucy&quot;, gender : &quot;w&quot;},
    {},
    {}
]
//åªæœ‰ä¸€æ¡è®°å½• ä½†ä¹Ÿè¿”å›æ•°ç»„
//å–å¾—è¯¥æ¡è®°å½• éœ€è¦ä½¿ç”¨arr[0]
rows = [
    {uid : 1, uname : &quot;lucy&quot;, gender : &quot;w&quot;},
]
</code></pre>
</li>
<li>
<p>findï¼šè€Œfind/findOneæ˜¯è¿”å›ç»“æœé›†ä¸­çš„ä¸€æ¡ï¼ˆlimit 1ï¼‰æ“ä½œï¼Œé‡è¦çš„æ˜¯å®ƒè¿”å›ä¸€ç»´çš„æ•°æ®å¯¹è±¡</p>
<ul>
<li>findå…¶å®å°±æ˜¯ç»™select()æ–¹æ³•ä¸­è®¾ç½®äº†limitå‚æ•°å€¼ä¸º1ï¼Œç„¶åå¯¹ç»“æœè¿›è¡Œé‡æ„</li>
</ul>
<pre><code class="language-javascript">function find(fields, tbname, condition, order) {
    //è°ƒç”¨äº†select å†™æ­»äº†limitä¸º1
    const result = select(fields, tbname, condition, order, 1);
    //å°†ç»“æœé›†æ•°ç»„ è½¬åŒ–æˆæ•°æ®å¯¹è±¡
    return result.length ? result[0] : {} 
}
const row = find(&quot;*&quot;, &quot;users&quot;, &quot;uid &gt; 100&quot;, &quot;uid DESC&quot;);
</code></pre>
<pre><code class="language-json">//findè¿”å›ä¸€ä¸ªæ•°æ®å¯¹è±¡ å½¢å¦‚ä¸‹é¢ï¼š
row = {
    uid : 1, 
    uname : &quot;lucy&quot;, 
    gender : &quot;w&quot;
},
</code></pre>
</li>
<li>
<p>addï¼šadd/insert/createç”¨æ¥æ·»åŠ ä¸€æ¡è®°å½•åˆ°è¡¨ä¸­ï¼Œå®ƒé€šå¸¸è¿”å›ä¸€ä¸ªOKPackageå¯¹è±¡ï¼›å¦‚æœè¦åŒæ—¶æ’å…¥å¤šæ¡æ•°æ®ï¼Œéœ€è¦è‡ªå·±æ¥å¾ªç¯ï¼Œæ–¹æ³•æœ¬èº«æ˜¯ä¸æ”¯æŒçš„ã€‚</p>
<ul>
<li>æ’å…¥è¯­å¥çš„ç»“æ„ï¼š<code>INSERT INTO(uid, uname) VALUES (1, 'lucy')</code></li>
<li>æå–å‚æ•°ä¸º å­—æ®µåˆ—è¡¨å’Œå€¼çš„æ˜ å°„å¯¹è±¡ <code>{ uid : 1, uname : &quot;lucy&quot;}</code></li>
</ul>
<pre><code class="language-javascript">const OKPacket = add(&quot;users&quot;, {uid : 1, uname : &quot;lucy&quot;,,,,});
console.log(&quot;æ–°å¢è¡ŒIDä¸ºï¼š&quot; + OkPacket.insertId);
</code></pre>
</li>
<li>
<p>saveï¼šsave/updateæ˜¯ç”¨æ¥ä¿®æ”¹ä¸€æ¡è®°å½•ï¼Œå®ƒåŒaddå¾ˆåƒï¼ŒåŒºåˆ«åœ¨äºsaveæ“ä½œæ—¶ä¼šæœ‰ä¸€ä¸ªwhereæ¡ä»¶ã€‚</p>
<pre><code class="language-javascript">const OKPacket = save(&quot;users&quot;, {uname : &quot;Kate&quot;}, &quot;uid = 1&quot;);
console.log(&quot;ä¿®æ”¹äº†&quot; + OkPacket.affectedRows);
</code></pre>
</li>
<li>
<p>deleteï¼šdeleteæ–¹æ³•åˆ é™¤è®°å½•ï¼Œå®ƒéœ€è¦åˆ é™¤æ¡ä»¶ï¼Œå¦‚æœä¸è®¾ç½®åˆ™æ˜¯æ•´è¡¨çš„åˆ é™¤</p>
<pre><code class="language-javascript">const OKPacket = delete(&quot;user&quot;, &quot;uname = 'demo'&quot;);
console.log(&quot;åˆ é™¤äº†&quot; + OKpacket.affectedRows);
</code></pre>
</li>
<li>
<p>runSql ï¼šå½“æ‰§è¡Œè¾ƒä¸ºå¤æ‚çš„sqlæ“ä½œæ—¶ï¼Œä¸€èˆ¬æ²¡æœ‰é€‚ç”¨çš„æ–¹æ³•ï¼Œè¿™æ ·å°±éœ€è¦æ‰‹å†™sqlè¯­å¥æ¥è¿è¡Œ</p>
<pre><code class="language-javascript">runSql(&quot;SELECT * FROM users&quot;);
</code></pre>
</li>
</ul>
<h2 id="lautin-model">lautin-model</h2>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨æ¡†æ¶ï¼Œä¾‹å¦‚<code>expressã€koa</code>ã€‚å®ƒä»¬éƒ½æœ‰å†…ç½®çš„å¯¹mongodbæ•°æ®åº“å°è£…çš„æ¨¡å‹ï¼Œå¯¹äºmysqlæ¨¡å—çš„æ‰©å±•ï¼Œé€šå¸¸éœ€è¦é€šè¿‡npmæ¥ä¸‹è½½å’Œå®‰è£…ã€‚è¿›å…¥<code>npmjs.com</code>æœç´¢<code>model</code>å…³é”®å­—ï¼Œå¾ˆå¤šå¾ˆå¤šå‘å¸ƒçš„å…³äºmysql modelçš„åŒ…ï¼Œå…¶ä¸­lautin-modelæ˜¯æ¯”è¾ƒä¼˜ç§€çš„ä¸€æ¬¾ï¼Œæ¨èä½¿ç”¨ï¼š</p>
<h3 id="ä¸‹è½½å®‰è£…">ä¸‹è½½å®‰è£…</h3>
<ul>
<li><code>npm install lautin-model</code></li>
<li>é…ç½®æ•°æ®åº“è¿æ¥ï¼š</li>
</ul>
<pre><code class="language-javascript">const db = require(&quot;lautin-model&quot;);
db.setConnection({
    type : &quot;mysql&quot;,	//åŠ è½½çš„é©±åŠ¨
    host : &quot;localhost&quot;,	//æ•°æ®åº“åœ°å€
    user : &quot;root&quot;,	//è´¦å·
    password : &quot;&quot;,	//å¯†ç 
    database : &quot;test&quot;,	//é€‰æ‹©æ•°æ®åº“
});	//é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯
</code></pre>
<ul>
<li>å…¨å±€å°è£…çš„ <code>M(è¡¨å)æ–¹æ³•</code> è¿›è¡Œæ•°æ®æ“ä½œ</li>
</ul>
<pre><code class="language-javascript">M(&quot;users&quot;).find((err, result) =&gt; {
    if (err) console.dir(err);
    else console.log(result);
});
</code></pre>
<h3 id="åŸºæœ¬curd">åŸºæœ¬CURD</h3>
<ul>
<li>
<p>addæ–¹æ³•æ·»åŠ ä¸€æ¡è®°å½•</p>
<ul>
<li>ç”¨æ³•ï¼š<code>M(è¡¨å).add(æ•°æ®).then(resolve, reject)</code></li>
<li>ç¤ºä¾‹ï¼š</li>
</ul>
<pre><code class="language-javascript">const pms = M(&quot;users&quot;).add({
    uname : &quot;ç†å‡¯æ—‹&quot;,
    nickname : &quot;å­™è¡Œè€…&quot;,
    password : md5('123456'),	//md5åŒ…éœ€è¦é¢å¤–å®‰è£…
});	//æ•°æ®æ“ä½œç»“æœä¸ºä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„Promise
    //ä½¿ç”¨thenæ¥æ¥æ”¶å®Œæˆæ—¶çš„ç»“æœæˆ–é”™è¯¯
pms.then((result) =&gt; {
    //å¢åˆ æ”¹è¿”å›OkPacketå¯¹è±¡ æŸ¥è¯¢è¿”å›RowDataPacketé›†åˆ
    console.log(result);
}, (err) =&gt; {
    //errå¯¹è±¡ä¸­ åŒ…å«sqlè¯­å¥ï¼Œsqlé”™è¯¯æç¤ºä»¥åŠmysqlé”™è¯¯å·
    console.log(err);
});
</code></pre>
</li>
<li>
<p>saveæ–¹æ³•ä¿®æ”¹è¡¨è®°å½•</p>
<ul>
<li>ç”¨æ³•ï¼š<code>M(è¡¨å).save({æ–°æ•°æ®, æ¡ä»¶}).then(resolve, reject)</code></li>
<li>ç¤ºä¾‹ï¼š</li>
</ul>
<pre><code class="language-javascript">//ä¿®æ”¹ç¼–å·100çš„ç”¨æˆ·æ˜µç§°ä¸ºfoo
M(&quot;users&quot;).save({
    data : {
        nickname : &quot;foo&quot;,
    },
    //whereæ¡ä»¶å³å¯ä»¥æ˜¯å­—ç¬¦ä¸²('uid=100') ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡å½¢å¼
    where : {
        uid : 100
    },
}).then((result) =&gt; {}, (err) =&gt; {});
</code></pre>
</li>
<li>
<p>deleteåˆ é™¤è®°å½•</p>
<ul>
<li>ç”¨æ³•ï¼š<code>M(è¡¨å).delete(æ¡ä»¶).then(resolve, reject)</code></li>
<li>ç¤ºä¾‹ï¼š</li>
</ul>
<pre><code class="language-javascript">//åˆ é™¤ç¼–å·ä¸º100çš„ç”¨æˆ·è®°å½•
M(&quot;users&quot;).delete({uid : 100}).then((result) =&gt; {}, (err) =&gt; {});
//è¿˜å¯ä»¥ç›´æ¥ä¼ å…¥ä¸€ä¸ªæ•°å€¼ è¡¨ç¤ºåˆ é™¤ä¸»é”®ç¼–å·ä¸ºè¯¥å€¼çš„ä¸€æ¡è®°å½•
M(&quot;user&quot;).delete(100).then((result) =&gt; {}, (err) =&gt; {})
</code></pre>
</li>
<li>
<p>selectæŸ¥è¯¢å¤šæ¡è®°å½•</p>
<ul>
<li>ç”¨æ³•ï¼š<code>M(è¡¨å).select({å­—æ®µåˆ—è¡¨, æ¡ä»¶, æ’åºè§„åˆ™, é™åˆ¶è¡Œæ•°}).then(resolve, reject)</code></li>
<li>ç¤ºä¾‹ï¼š</li>
</ul>
<pre><code class="language-javascript">//æŸ¥è¯¢æœ€æ–°ä¸Šæ¶çš„ç¬”è®°æœ¬ åªæ˜¾ç¤º10æ¡
M(&quot;goods&quot;).select({
    where : {gname : [&quot;like&quot;, &quot;%ç¬”è®°æœ¬%&quot;]},	// `gname` LIKE '%ç¬”è®°æœ¬%'
    order : &quot;created DESC&quot;,
    limit : 10,
}).then((result) =&gt; {
    //resultè¿”å›å¯¹è±¡é›†åˆæ•°ç»„ å³ä½¿åªæœ‰æŸ¥è¯¢ç»“æœ[{}]
    console.log(result);
}, (err) =&gt; {});
</code></pre>
</li>
<li>
<p>findæŸ¥æ‰¾ä¸€æ¡ç»“æœ</p>
<ul>
<li>ç”¨æ³•ï¼š<code>M(è¡¨å).find({å­—æ®µåˆ—è¡¨, æ¡ä»¶, æ’åºè§„åˆ™}).then(resolve, reject)</code></li>
<li>ç¤ºä¾‹ï¼š</li>
</ul>
<pre><code class="language-javascript">//æŸ¥æ‰¾è´¦å·ä¸ºlautin æˆ–è€… é‚®ç®±ä¸º1538731090@qq.comçš„ç”¨æˆ·
M(&quot;users&quot;).find({
    where : {
        uname : &quot;lautin&quot;,
        email : &quot;1538731090@qq.com&quot;,
        _logic : &quot;OR&quot;
    },		
}).then((result) =&gt; {
    //è¿”å›ä¸€ä¸ªæ•°æ®å¯¹è±¡ ä¸æ˜¯é›†åˆå½¢å¼
    console.log(result);
}, (err) =&gt; {});
</code></pre>
</li>
</ul>
<h3 id="é“¾å¼æ“ä½œ">é“¾å¼æ“ä½œ</h3>
<p>ä¸Šè¿°æ–¹æ³•ï¼Œé™¤äº†åœ¨æ–¹æ³•ä½“å†…ä¸€æ¬¡æ€§ä¼ å‚å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨é“¾å¼è°ƒç”¨ åˆ†åˆ«è®¾ç½®å‚æ•°ï¼š</p>
<ul>
<li>data()æ–¹æ³•ï¼šåˆ›å»ºæ•°æ®ï¼Œä¼ å…¥ä¸€ä¸ªæ•°æ®å¯¹è±¡</li>
<li>where()æ–¹æ³•ï¼šè®¾ç½®æ¡ä»¶ï¼Œæ”¯æŒå­—ç¬¦ä¸²å’Œå¯¹è±¡ä¸¤ç§å½¢å¼ï¼Œå‚æ•°æ ¼å¼å¦‚ä¸‹ï¼š
<ul>
<li><code>'id = 100'</code>ç­‰ç­‰å…¶å®ƒè¿ç®—ç¬¦è¡¨è¾¾å¼</li>
<li><code>{uname : 'foo', password : 'bar' }</code>  å¤šä¸ªæ¡ä»¶é»˜è®¤ANDè¿æ¥</li>
<li><code>{uname : 'lautin', email : '1538731090@qq.com', _logic:'OR' }</code> è®¾ç½®ORè¿æ¥</li>
<li><code>{uname : ['LIKE', '%abc%'] }</code>   æ¨¡ç³ŠæŸ¥è¯¢</li>
<li><code>{id : ['IN' , '1,3,5' ] }</code> ç¼–å·ä¸º1,3,5çš„è®°å½•</li>
<li><code>{id : [' NOT IN', '2,4,6'] }</code> ç¼–å·2,4,6ä»¥å¤–çš„è®°å½•</li>
<li><code>{id : ['BETWEEN', '10, 20'] }</code>ç¼–å·10åˆ°20ä¹‹é—´çš„è®°å½•</li>
</ul>
</li>
<li>order()æ–¹æ³•ï¼šè®¾ç½®æ’åºè§„åˆ™ï¼Œä¼ å…¥å­—ç¬¦ä¸² ä¾‹å¦‚ï¼š <code>uid DESC</code></li>
<li>limit()æ–¹æ³•ï¼šé™åˆ¶è¡Œæ•°ï¼Œä¼ å…¥æ•°å€¼æˆ–è€…å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š<code>5</code> æˆ–è€… <code>'0, 5'</code></li>
</ul>
<p>é“¾å¼æ“ä½œä¸­ï¼Œå¯ä»¥ç»“åˆå®é™…æƒ…å†µ é€‰æ‹©ä¸Šè¿°æ–¹æ³•ã€‚é“¾å¼æ–¹æ³•åœ¨è°ƒç”¨æ—¶ <strong>æ— éœ€è€ƒè™‘å®ƒä»¬çš„é¡ºåº</strong>  <mark>ä½†å¿…é¡»ä»¥curdçš„è°ƒç”¨æ–¹æ³•ç»“æŸ</mark>ï¼Œæ­¤æ—¶curdæ–¹æ³•ä¸­ æ— éœ€å†ä¼ å…¥sqlåˆ†æ®µå‚æ•°ã€‚</p>
<pre><code class="language-javascript">const pms = M(&quot;users&quot;).data({}).add();
//const pms = M(&quot;users&quot;).data().where().save();
//const pms = M(&quot;users&quot;).where().delete();
//const pms = M(&quot;users&quot;).where().order().limit().select();
//const pms = M(&quot;users&quot;).where().order().find();

//å†ç›‘å¬pms
pms.then(resolve, reject);
</code></pre>
<h3 id="å›è°ƒå‡½æ•°">å›è°ƒå‡½æ•°</h3>
<p>åœ¨é“¾å¼æ“ä½œä¸­ï¼Œcurdæ–¹æ³• æ— éœ€å†ä¼ å…¥sqlå‚æ•°ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨thenæ–¹æ³•æ¥æ”¶Promiseå†³è®®ç»“æœã€‚å¤„ç†Promiseå¤–ï¼Œé“¾å¼æ“ä½œçš„curdæ–¹æ³•ä¸­ è¿˜å¯ä»¥ç›´æ¥ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥æ¥æ”¶ç»“æœï¼š</p>
<pre><code class="language-javascript">M(&quot;users&quot;).where().order().select((err, result) =&gt; {
    if (err) console.log(err);
    else console.log(result);
});//ä½¿ç”¨å›è°ƒå‡½æ•°å æ— éœ€å†thenï¼Œå…¶ä»–æ“ä½œæ–¹æ³•åŒæ ·ä½¿ç”¨
</code></pre>
<h3 id="é«˜çº§åº”ç”¨">é«˜çº§åº”ç”¨</h3>
<ul>
<li>æ‰‹å†™sqlè¯­å¥ï¼š</li>
</ul>
<p>å¯¹äºå¤æ‚çš„ä¸šåŠ¡å¤„ç†æ—¶ï¼Œå¾€å¾€éœ€è¦ä½¿ç”¨é«˜çº§sqlè¯­å¥ã€‚ä¾‹å¦‚ï¼šè”åˆæŸ¥è¯¢ã€äº¤å‰è¿æ¥ã€äº‹ç‰©å’Œå­˜å‚¨è¿‡ç¨‹ç­‰ã€‚è¿™æ ·curdæ–¹æ³•è‡ªç„¶æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œä½†å†…ç½®çš„runSql()å¯ä»¥æ¥æ”¶ä¸€æ¡sqlè¯­å¥ æ¥å®šåˆ¶å®é™…éœ€æ±‚ã€‚</p>
<pre><code class="language-javascript">//æ‰§è¡ŒsqlæŒ‡ä»¤æ—¶ è®¾ç½®ç©ºæ¨¡å‹å³å¯
M().runSql(sql, (err, result) =&gt; {
    
});
</code></pre>
<ul>
<li>è‡ªå®šä¹‰è¡¨æ¨¡å‹ï¼š</li>
</ul>
<p>å¦‚æœæƒ³è¦å®šåˆ¶è‡ªå·±çš„æ¨¡å‹æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºè¡¨æ¨¡å‹ç±»æ¥å®Œæˆã€‚è¯¥æ¨¡å‹éœ€è¦ç»§æ‰¿æ ¸å¿ƒçš„Modelç±»ï¼Œåœ¨ä½¿ç”¨å‰éœ€è¦é…ç½®æ¨¡å‹å­˜æ”¾çš„æ ¹è·¯å¾„ï¼Œè¯¥è·¯å¾„å¿…é¡»æ˜¯ä¸€ä¸ªç»å¯¹åœ°å€ï¼š</p>
<pre><code class="language-javascript">const path = require(&quot;path&quot;);
//ä½¿ç”¨path.resolve()æ–¹æ³• è½¬åŒ–ç»å¯¹è·¯å¾„
db.use(&quot;model&quot;, path.resolve(&quot;./models&quot;));
</code></pre>
<pre><code class="language-javascript">//æ–‡ä»¶åå¿…é¡»å’Œæ¨¡å‹ç±»åç§°ä¿æŒä¸€è‡´ï¼Œä¾‹å¦‚ ~/models/CateModel.js
module.exports = function (Model) {

    class CateModel extends Model {

        constructor() {
    
            //éƒ¨ç½²è¡¨åã€å‰ç¼€å’Œä¸»é”®
            super({
                tableName: &quot;category&quot;,
                tablePrefix: &quot;shop_&quot;,
                pk : &quot;cid&quot;,
            });
    		
            getNameById(cid) {
                //to do here
                
            }
        };

         
    }

    return CateModel;

}
</code></pre>
<p>å¯¹äºè‡ªå®šä¹‰çš„è¡¨æ¨¡å‹éœ€è¦ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°è§„èŒƒæ¥å®šä¹‰ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨<code>make model CateModel</code>æ¥å¸®ä½ å¿«é€Ÿç”Ÿæˆã€‚å½“åˆ›å»ºå¥½æ¨¡å‹åï¼Œä½¿ç”¨D(ç±»å) åˆ›å»ºå®ƒçš„ç¤ºä¾‹ï¼š</p>
<pre><code class="language-javascript">D(&quot;CateModel&quot;).getNameById(100);
</code></pre>
<hr>
<p align="right">posted @ Zycin (éè½¬è½½ æ¥è‡ªä¸ªäººå­¦ä¹ èµ„æ–™æ•´ç†)</p>

        </div>

        
          <a class="animated fadeInUp p-2 items-center text-sm text-gray-700 border hover:bg-gray-300 leading-none rounded-full flex lg:inline-flex m-4 " href="https://fastt.cn/tag/node">
            <span class="flex-auto">node</span>
          </a>
        


        <div class="flex justify-between py-8">
          
            <div class="prev-post">
              <a href="https://fastt.cn/post/es6">
                <h3 class="post-title">
                  <i class="remixicon-arrow-left-line"></i>
                  ES6çš„è¯­æ³•
                </h3>
              </a>
            </div>
          

          
            <div class="next-post">
              <a href="https://fastt.cn/post/nodejs3">
                <h3 class="post-title">
                  nodeJSç¬¬ä¸‰é˜¶æ®µ
                  <i class="remixicon-arrow-right-line"></i>
                </h3>
              </a>
            </div>
          
        </div>

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: 'f9c4cb98113788bb94e1',
    clientSecret: 'd271ed343d3af9b71c24dff543d9c3e1e4d70a4b',
    repo: 'zycin.github.io',
    owner: 'zycin',
    admin: ['zycin'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

      </div>
    </div>

    <script src="https://fastt.cn/media/prism.js"></script>  
<script>

Prism.highlightAll()

let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

// This should probably be throttled.
// Especially because it triggers during smooth scrolling.
// https://lodash.com/docs/4.17.10#throttle
// You could do like...
// window.addEventListener("scroll", () => {
//    _.throttle(doThatStuff, 100);
// });
// Only not doing it here to keep this Pen dependency-free.

window.addEventListener("scroll", event => {
  let fromTop = window.scrollY;

  mainNavLinks.forEach((link, index) => {
    let section = document.getElementById(decodeURI(link.hash).substring(1));
    let nextSection = null
    if (mainNavLinks[index + 1]) {
      nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
    }
    if (section.offsetTop <= fromTop) {
      if (nextSection) {
        if (nextSection.offsetTop > fromTop) {
          link.classList.add("current");
        } else {
          link.classList.remove("current");    
        }
      } else {
        link.classList.add("current");
      }
    } else {
      link.classList.remove("current");
    }
  });
});


document.addEventListener("DOMContentLoaded", function() {
  var lazyImages = [].slice.call(document.querySelectorAll(".post-feature-image.lazy"));

  if ("IntersectionObserver" in window) {
    let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          let lazyImage = entry.target
          lazyImage.style.backgroundImage = `url(${lazyImage.dataset.bg})`
          lazyImage.classList.remove("lazy")
          lazyImageObserver.unobserve(lazyImage)
        }
      });
    });

    lazyImages.forEach(function(lazyImage) {
      lazyImageObserver.observe(lazyImage)
    })
  } else {
    // Possibly fall back to a more compatible method here
  }
});

const menuContainer = document.querySelector('.menu-container')
const menus = document.querySelectorAll('.menu-container .menu')
const mask = document.querySelector('.mask')
const contentWrapper = document.querySelector('.content-wrapper')
const latestArticle = document.querySelector('.latest-article')
const readMore = document.querySelector('.read-more')
const indexPage = document.querySelector('.index-page')

const isHome = location.pathname === '/'
if (latestArticle) {
  latestArticle.style.display = isHome ? 'block' : 'none'
  readMore.style.display = isHome ? 'block' : 'none'
  indexPage.style.display = isHome ? 'none' : 'block'
}

const openMenu = () => {
  menuContainer.classList.add('open')
  menus.forEach(menu => {
    menu.classList.add('animated', 'fadeInLeft')
  })
  mask.classList.add('open')
  contentWrapper.classList.add('is-second')
}

const closeMenu = () => {
  menuContainer.classList.remove('open')
  menus.forEach(menu => {
    menu.classList.remove('animated', 'fadeInLeft')
  })
  mask.classList.remove('open')
  contentWrapper.classList.remove('is-second')
}
</script>
  
  </body>
</html>
